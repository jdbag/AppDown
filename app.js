const express=require('express');const mariadb=require('mariadb');const app=express();app.use(express.json());const pool=mariadb.createPool({host:'127.0.0.1',port:3306,user:'appuser',password:'.2',database:'appdown'});app.get('/status',async(req,res)=>{try{const conn=await pool.getConnection();const rows=await conn.query('SELECT CURRENT_USER();');conn.release();res.json({status:'ok',dbUser:rows[0]['CURRENT_USER()']});}catch(err){res.status(500).json({status:'error',message:err.message});}});app.post('/payments/create',async(req,res)=>{const{amount,userId}=req.body;try{const conn=await pool.getConnection();await conn.query('INSERT INTO payments (user_id,amount,status) VALUES (?,?,"created")',[userId,amount]);conn.release();res.json({status:'ok',message:'Payment created'});}catch(err){res.status(500).json({status:'error',message:err.message});}});app.post('/payments/approve',async(req,res)=>{const{paymentId}=req.body;try{const conn=await pool.getConnection();await conn.query('UPDATE payments SET status="approved" WHERE id=?',[paymentId]);conn.release();res.json({status:'ok',message:'Payment approved'});}catch(err){res.status(500).json({status:'error',message:err.message});}});app.post('/payments/complete',async(req,res)=>{const{paymentId}=req.body;try{const conn=await pool.getConnection();await conn.query('UPDATE payments SET status="completed" WHERE id=?',[paymentId]);conn.release();res.json({status:'ok',message:'Payment completed'});}catch(err){res.status(500).json({status:'error',message:err.message});}});app.get('/payments/list',async(req,res)=>{try{const conn=await pool.getConnection();const rows=await conn.query('SELECT * FROM payments');conn.release();res.json({status:'ok',payments:rows});}catch(err){res.status(500).json({status:'error',message:err.message});}});app.listen(3000,()=>console.log('AppDown API running on port 3000'));
